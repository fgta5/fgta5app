/*! user
*
* Agung Nugroho DW
* https://github.com/agungdhewe
*
* build at 2025-08-07
*/
import e from"../module.mjs";const t=new $fgta5.Application("mainapp");var a={app:t,Crsl:new $fgta5.SectionCarousell(t.Nodes.Main),Sections:{userheaderList:"userHeaderList-section",userheaderEdit:"userHeaderEdit-section"}};const n=a.Crsl,i=a.Sections.userheaderEdit,s=n.Items[i],r=new $fgta5.Form("userHeaderEdit-frm"),o="View User",d="Edit User",c="Edit",l="Lock",u=new $fgta5.ActionButton("userHeaderEdit-btn_edit"),f=new $fgta5.ActionButton("userHeaderEdit-btn_save"),g=new $fgta5.ActionButton("userHeaderEdit-btn_new","userHeader-new"),y=new $fgta5.ActionButton("userHeaderEdit-btn_delete"),w=new $fgta5.ActionButton("userHeaderEdit-btn_reset"),v=new $fgta5.ActionButton("userHeaderEdit-btn_prev"),m=new $fgta5.ActionButton("userHeaderEdit-btn_next"),h=s;async function b(t,n){s.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async t=>{!async function(t,a){let n=!1;if(r.isChanged()){var i=await $fgta5.MessageBox.confirm(e.BACK_CONFIRM);"ok"==i&&(n=!0),i=null}else n=!0;n&&(r.reset(),a.detail.fn_ShowNextSection())}(0,t)}),r.addEventListener("locked",e=>{!async function(){s.Title=o,u.setText(c),u.disabled=!1,f.disabled=!0,g.disabled=!1,y.disabled=!0,w.disabled=!0,v.disabled=!1,m.disabled=!1}()}),r.addEventListener("unlocked",e=>{!async function(){s.Title=d,u.setText(l),u.disabled=!1,f.disabled=!1,g.disabled=!0,y.disabled=!1,w.disabled=!1,v.disabled=!0,m.disabled=!0}()}),r.render(),u.addEventListener("click",t=>{!async function(){if(r.isLocked())r.lock(!1);else{if(r.isChanged()||r.isNew())return void await $fgta5.MessageBox.warning(e.EDIT_WARNING);r.lock(!0)}}()}),f.addEventListener("click",e=>{!async function(){try{await async function(){}(),r.acceptChanges(),u.disabled=!1}catch(e){await $fgta5.MessageBox.error(e.message)}}()}),g.addEventListener("click",e=>{!async function(e,t){var n=t.target.getAttribute("data-sectionsource"),i=a.Sections[mainapp.HEADERLIST].sectionId,r=n===i;r?(s.show(),E(e,r)):E(e)}(t,e)}),y.addEventListener("click",e=>{!async function(){}()}),w.addEventListener("click",t=>{!async function(){if(r.isChanged()||r.isNew()){if("ok"!=await $fgta5.MessageBox.confirm(e.RESET_CONFIRM))return}r.reset()}()}),v.addEventListener("click",e=>{!async function(){}()}),m.addEventListener("click",e=>{!async function(){}()})}async function E(t,a){if(!a){let t=!1;if(r.isChanged())"cancel"==await $fgta5.MessageBox.confirm(e.NEWDATA_CONFIRM)&&(t=!0);if(t)return}p(t,r.AutoID?{disabled:!0,placeholder:"[AutoID]"}:{disabled:!1,placeholder:"ID"}),r.lock(!1),r.newData({}),r.acceptChanges(),s.Title="New User",u.disabled=!0}async function p(e,t){var a=r.PrimaryKey,n=r.Inputs[a],i=document.getElementById(a),s=null==t.placeholder?"ID":t.placeholder;n.disabled=!0===t.disabled,i.setAttribute("placeholder",s)}function L(e,t){t.searchgroup.setSelected("20","Operations")}const k=a.Crsl,A=a.Sections.userheaderList,$=k.Items[A],C=new $fgta5.Gridview("userHeaderList-tbl"),S=document.getElementById("userHeaderList-pnl_search"),B=new $fgta5.ActionButton("userHeaderList-btn_gridload"),T={};async function I(t,a){try{const a=document.querySelector('template[name="custom-search-panel"]');if(null!=a){const e=a.content.cloneNode(!0);S.prepend(e)}const o=S.querySelectorAll("[fgta5-component][binding");for(var n of o){var i=n.getAttribute("id"),s=n.getAttribute("fgta5-component"),r=n.getAttribute("binding");T[r]=new $fgta5[s](i)}L(0,T),C.addEventListener("nextdata",async e=>{!async function(e,t){var a=t.detail.criteria,n=t.detail.limit,i=t.detail.nextoffset,s=t.detail.sort;await x(e,{criteria:a,limit:n,offset:i,sort:s}),C.scrollToFooter()}(t,e)}),C.addEventListener("sorting",async e=>{!async function(e,t){C.clear();var a=t.detail.sort,n=t.detail.Criteria;x(e,{criteria:n,sort:a})}(t,e)}),C.addEventListener("cellclick",async a=>{!async function(t,a){e.isMobileDevice()&&await N(t,a)}(t,a)}),C.addEventListener("celldblclick",async e=>{N(t,e)}),B.addEventListener("click",async e=>{!async function(){await C.clear(),x()}()})}catch(e){throw e}finally{!0===a.autoLoadGridData&&await x()}}async function N(e,t){var a=t.detail.tr,n=a.getAttribute("keyvalue"),i=a.getAttribute("key");h.show();try{!async function(e,t){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t.keyvalue})};p(0,{disabled:!0});var n=$fgta5.Modal.createMask(),i=new $fgta5.Dataloader;try{var s=await i.load("/user/header-open-data",a);if(0!=s.code)throw new Error("server: "+s.message);var o=s.result;r.setData(o),r.acceptChanges(),r.lock()}catch(e){throw e}finally{n.close(),i.dispose(),i=null,n=null}}(0,{key:i,keyvalue:n,tr:a})}catch(e){await $fgta5.MessageBox.error(e.message),$.show()}}async function x(e,t={}){var{criteria:a={},limit:n=0,offset:i=0,sort:s={}}=t;for(var r in T){if(!T[r].validate())return!1;a[r]=T[r].value}void 0===s&&(s=C.getSort());var o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({columns:[],criteria:a,offset:i,limit:n,sort:s})},d=$fgta5.Modal.createMask(),c=new $fgta5.Dataloader;try{var l=await c.load("/user/header-list",o),u=l.code,f=l.message,g=l.result;if(0!=u){var y=new Error("Server Error: "+f);throw y.code=u,y}void 0===i&&C.clear(),C.addRows(g.data),C.setNext(g.nextoffset,g.limit)}catch(y){$fgta5.MessageBox.error(y.message)}finally{d.close(),c.dispose(),c=null,d=null}}const _=a.app,H=a.Crsl;class M extends e{constructor(){super()}async main(e={}){_.setTitle("User"),_.showFooter(!0),e.autoLoadGridData=!0;try{await I(self,e),await b(self),await async function(e){try{const t=document.getElementsByClassName("footer-buttons-container");e.renderFooterButtons(t),H.addEventListener($fgta5.SectionCarousell.EVT_SECTIONSHOWING,e=>{var a=e.detail.commingSection.Id;for(let e of t){e.getAttribute("data-section")==a?setTimeout(()=>{e.classList.remove("hidden"),e.style.animation="dropped 0.3s forwards",setTimeout(()=>{e.style.animation="unset"},300)},500):e.classList.add("hidden")}})}catch(e){throw e}}(this)}catch(e){throw e}}}export{M as default};
