/*! user
*
* Agung Nugroho DW
* https://github.com/agungdhewe
*
* build at 2025-08-08
*/
import e from"../module.mjs";const t=new $fgta5.Application("mainapp");var a={app:t,Crsl:new $fgta5.SectionCarousell(t.Nodes.Main),Sections:{userheaderList:"userHeaderList-section",userheaderEdit:"userHeaderEdit-section"}};const n=a.Crsl,r=a.Sections.userheaderList,i=n.Items[r],s=new $fgta5.Gridview("userHeaderList-tbl"),o=document.getElementById("userHeaderList-pnl_search"),d=new $fgta5.ActionButton("userHeaderList-btn_gridload"),c=i,l={};async function u(t,a){s.addEventListener("nextdata",async e=>{!async function(e,t){var a=t.detail.criteria,n=t.detail.limit,r=t.detail.nextoffset,i=t.detail.sort;await g(e,{criteria:a,limit:n,offset:r,sort:i}),s.scrollToFooter()}(t,e)}),s.addEventListener("sorting",async e=>{!async function(e,t){s.clear();var a=t.detail.sort,n=t.detail.Criteria;g(e,{criteria:n,sort:a})}(t,e)}),s.addEventListener("cellclick",async a=>{!async function(t,a){e.isMobileDevice()&&await f(t,a)}(t,a)}),s.addEventListener("celldblclick",async e=>{f(t,e)}),d.addEventListener("click",async e=>{!async function(){await s.clear(),g()}()});try{const e=document.querySelector('template[name="custom-search-panel"]');if(null!=e){const t=e.content.cloneNode(!0);o.prepend(t)}const a=o.querySelectorAll("[fgta5-component][binding");for(var n of a){var r=n.getAttribute("id"),i=n.getAttribute("fgta5-component"),c=n.getAttribute("binding");l[c]=new $fgta5[i](r)}const s=t.Modules.userExtender.initSearchParams;"function"==typeof s&&s(t,l)}catch(e){throw e}finally{!0===a.autoLoadGridData&&g()}}async function f(e,t){var a=t.detail.tr,n=a.getAttribute("keyvalue"),r=a.getAttribute("key"),s=e.Modules.userHeaderEdit;s.show();try{await s.dataOpen(e,{key:r,keyvalue:n,tr:a})}catch(e){console.error(e),await $fgta5.MessageBox.error(e.message),i.show()}}async function g(e,t={}){var{criteria:a={},limit:n=0,offset:r=0,sort:i={}}=t;for(var o in l){if(!l[o].validate())return console.error("ada yang belum diisi"),!1;a[o]=l[o].value}void 0===i&&(i=s.getSort());var d={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({columns:[],criteria:a,offset:r,limit:n,sort:i})},c=$fgta5.Modal.createMask(),u=new $fgta5.Dataloader;try{var f=await u.load("/user/header-list",d),g=f.code,y=f.message,w=f.result;if(0!=g){var v=new Error("Server Error: "+y);throw v.code=g,v}void 0===r&&s.clear(),s.addRows(w.data),s.setNext(w.nextoffset,w.limit)}catch(v){console.error(v),$fgta5.MessageBox.error(v.message)}finally{c.close(),u.dispose(),u=null,c=null}}var y=Object.freeze({__proto__:null,SearchParams:l,Section:c,init:u,render:async function(e){}});const w=a.Crsl,v=a.Sections.userheaderEdit,b=w.Items[v],h="View User",m="Edit User",E="Edit",p="Lock",_=new $fgta5.ActionButton("userHeaderEdit-btn_edit"),L=new $fgta5.ActionButton("userHeaderEdit-btn_save"),k=new $fgta5.ActionButton("userHeaderEdit-btn_new","userHeader-new"),C=new $fgta5.ActionButton("userHeaderEdit-btn_delete"),$=new $fgta5.ActionButton("userHeaderEdit-btn_reset"),A=new $fgta5.ActionButton("userHeaderEdit-btn_prev"),S=new $fgta5.ActionButton("userHeaderEdit-btn_next"),x=new $fgta5.Form("userHeaderEdit-frm"),B=x.Inputs.cbo_group_id,M=b;async function N(t,a){b.addEventListener($fgta5.Section.EVT_BACKBUTTONCLICK,async t=>{!async function(t,a){let n=!1;if(x.isChanged()){"ok"==await $fgta5.MessageBox.confirm(e.BACK_CONFIRM)&&(x.reset(),n=!0)}else n=!0;n&&(x.lock(),a.detail.fn_ShowNextSection())}(0,t)}),x.addEventListener("locked",e=>{!async function(){b.Title=h,_.setText(E),_.disabled=!1,L.disabled=!0,k.disabled=!1,C.disabled=!0,$.disabled=!0,A.disabled=!1,S.disabled=!1}()}),x.addEventListener("unlocked",e=>{!async function(){b.Title=m,_.setText(p),_.disabled=!1,L.disabled=!1,k.disabled=!0,C.disabled=!1,$.disabled=!1,A.disabled=!0,S.disabled=!0}()}),x.render(),_.addEventListener("click",t=>{!async function(){if(x.isLocked())x.lock(!1);else{if(x.isChanged()||x.isNew())return void await $fgta5.MessageBox.warning(e.EDIT_WARNING);x.lock(!0)}}()}),L.addEventListener("click",e=>{!async function(e){var t=x.isNew();if(!t&&!x.isChanged())return;try{await I(e,t),x.acceptChanges(),_.disabled=!1}catch(e){"warning"==e.level?await $fgta5.MessageBox.warning(e.message):(console.error(e),await $fgta5.MessageBox.error(e.message))}}(t)}),k.addEventListener("click",e=>{!async function(e,t){var a=t.target.getAttribute("data-sectionsource"),n=e.Module.userHeaderList,r=n.Section.Id,i=a===r;i?(b.show(),T(e,i)):T(e)}(t,e)}),C.addEventListener("click",e=>{!async function(){if(x.isNew())return}()}),$.addEventListener("click",a=>{!async function(t){if(x.isNew())T(t);else if(x.isChanged()){if("ok"!=await $fgta5.MessageBox.confirm(e.RESET_CONFIRM))return;x.reset()}}(t)}),A.addEventListener("click",e=>{!async function(){}()}),S.addEventListener("click",e=>{!async function(){}()}),B.addEventListener("selecting",e=>{try{t.fnExecute("cbo_group_id_selecting",{evt:e})}catch(e){console.error(e)}})}async function T(t,a){if(!a){let t=!1;if(x.isChanged())"cancel"==await $fgta5.MessageBox.confirm(e.NEWDATA_CONFIRM)&&(t=!0);if(t)return}H(t,x.AutoID?{disabled:!0,placeholder:"[AutoID]"}:{disabled:!1,placeholder:"ID"}),x.lock(!1),x.newData({}),x.acceptChanges(),x.setAsNewData(),b.Title="New User",_.disabled=!0,C.disabled=!0}async function I(e,t=!1){var a=x.validate();try{if(!a){var n=x.getLastError(),r=new Error(n);throw r.level="warning",r.message,r}t?x.getData():x.getDataChanged(),C.disabled=!0}catch(r){throw r}}async function H(e,t){var a=x.PrimaryKey,n=x.Inputs[a],r=document.getElementById(a),i=null==t.placeholder?"ID":t.placeholder;n.disabled=!0===t.disabled,r.setAttribute("placeholder",i)}var D=Object.freeze({__proto__:null,Section:M,dataOpen:async function(e,t){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t.keyvalue})};H(e,{disabled:!0});var n=$fgta5.Modal.createMask(),r=new $fgta5.Dataloader;try{var i=await r.load("/user/header-open",a);if(0!=i.code)throw new Error(i.message);var s=i.result;x.setData(s),x.acceptChanges(),x.lock()}catch(e){throw e}finally{n.close(),r.dispose(),r=null,n=null}},dataSave:I,init:N,newData:T,render:async function(e){},show:async function(e){b.show()}});async function O(e,t){e.Extender.cbo_group_id_selecting=({evt:t})=>{_cbo_group_id_selecting(e,t)}}var F=Object.freeze({__proto__:null,init:O});const P=a.app,j=a.Crsl;class R extends e{constructor(){super()}async main(e={}){P.setTitle("User"),P.showFooter(!0),e.autoLoadGridData=!0;const t=this;t.Extender={},t.Modules={userHeaderList:y,userHeaderEdit:D,userExtender:F};try{await Promise.all([u(t,e),N(t),O(t)]),await async function(e){try{const t=document.getElementsByClassName("footer-buttons-container");e.renderFooterButtons(t),j.addEventListener($fgta5.SectionCarousell.EVT_SECTIONSHOWING,e=>{var a=e.detail.commingSection.Id;for(let e of t){e.getAttribute("data-section")==a?setTimeout(()=>{e.classList.remove("hidden"),e.style.animation="dropped 0.3s forwards",setTimeout(()=>{e.style.animation="unset"},300)},500):e.classList.add("hidden")}});const a=e.Modules.userExtender.extendPage;"function"==typeof a&&a(e)}catch(e){throw e}}(t)}catch(e){throw e}}}export{R as default};
